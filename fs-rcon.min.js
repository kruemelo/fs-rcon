/*! fs-rcon@1.2.1 2015-11-11 */
!function(a){"undefined"!=typeof module?module.exports=a(require("./libs/CryptoJS.js")):"function"==typeof define&&"object"==typeof define.amd?define(["cryptojs"],a):"object"==typeof window&&(window.FSRCON=a(window.CryptoJS))}(function(a){"use strict";var b=function(){this.protocol=null,this.hostname=null,this.port=null,this.clientRandomKey=null,this.serverRandomKey=null,this.SID=null};return b.hash=function(b){return a.SHA512(b).toString(a.enc.Base64)},b.url=function(a,b){var c="";return c+=a.protocol,c+="://",c+=a.hostname,c+=a.port?":"+a.port:"",c+="/"+b},b.prototype.connect=function(a,c){return a.clientRandomKey||c(new Error("EINVALIDCRK")),this.clientRandomKey=a.clientRandomKey,this.serverRandomKey=b.hash(String(Math.random())+String(Math.random())),this.SID=b.hash(this.clientRandomKey+this.serverRandomKey),c(null),this},b.prototype.send=function(a,c,d){var e,f=b.url(this,c);return e=new XMLHttpRequest,e.open("POST",f,!0),e.setRequestHeader("Content-type","application/json"),e.setRequestHeader("Accept","application/json"),e.onload=function(){var a;try{a=JSON.parse(this.response)}catch(b){}void 0!==a&&this.status>=200&&this.status<300?d(null,a):d(new Error(this.response))},e.send(JSON.stringify({SID:this.SID,data:a})),e},b.prototype.init=function(a,c){var d,e=this,f="init",g="",h={};return this.protocol=a.protocol||"http",this.hostname=a.hostname||"localhost",this.port=a.port||"",g=b.url(this,f),d=new XMLHttpRequest,d.open("POST",g,!0),d.setRequestHeader("Content-type","application/json"),d.setRequestHeader("Accept","application/json"),d.onload=function(){var a=JSON.parse(this.response);a.SRK&&this.status>=200&&this.status<300?(e.serverRandomKey=a.SRK,e.SID=b.hash(e.clientRandomKey+e.serverRandomKey),c(null)):c(new Error(this.response))},this.clientRandomKey=b.hash(String(Math.random())+String(Math.random())),this.serverRandomKey=null,this.SID=null,h={CRK:this.clientRandomKey},d.send(JSON.stringify(h)),this},b});